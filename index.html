import React, { useState, useEffect } from 'react';

// START: Chart.js Configuration
// Chart.js is not a native React library, so we'll interact with it via its JS API.
// We'll import Chart.js and its necessary components for tree-shaking.
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  BarElement,
  Title,
  Tooltip,
  Legend,
  RadialLinearScale,
  PointElement,
  LineElement,
  Filler,
} from 'chart.js';

// Register the components we need for our charts. This is required for Chart.js v3+.
ChartJS.register(
  CategoryScale,
  LinearScale,
  BarElement,
  Title,
  Tooltip,
  Legend,
  RadialLinearScale,
  PointElement,
  LineElement,
  Filler
);
// We will use the 'Bar' and 'Radar' components from 'react-chartjs-2' for easier integration.
import { Bar, Radar } from 'react-chartjs-2';
// END: Chart.js Configuration


// START: Reusable UI Components
// A simple, reusable card component for consistent styling across the app.
const Card = ({ children, className = '', onClick }) => (
  <div
    className={`bg-white p-6 rounded-lg shadow-md transition-all duration-300 ${className} ${onClick ? 'cursor-pointer' : ''}`}
    onClick={onClick}
  >
    {children}
  </div>
);

// A reusable button component.
const Button = ({ children, onClick, className = '', variant = 'primary' }) => {
  const baseClasses = 'w-full md:w-auto font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105';
  const variants = {
    primary: 'bg-sky-700 hover:bg-sky-800 text-white',
    secondary: 'bg-teal-700 hover:bg-teal-800 text-white',
  };
  return (
    <button onClick={onClick} className={`${baseClasses} ${variants[variant]} ${className}`}>
      {children}
    </button>
  );
};
// END: Reusable UI Components


// START: Chart Components
// Component to render the Investor Persona Comparison Chart. Data is from the report.
const InvestorComparisonChart = () => {
  const data = {
    labels: ['Risk Profile', 'Operational Focus', 'Capital Source', 'Decision Driver'],
    datasets: [
      {
        label: 'Emerging Investor',
        data: [90, 80, 70, 75],
        backgroundColor: 'rgba(56, 189, 248, 0.7)', // sky-400
        borderColor: 'rgba(56, 189, 248, 1)',
        borderWidth: 1,
      },
      {
        label: 'Institutional Strategist',
        data: [40, 30, 20, 25],
        backgroundColor: 'rgba(14, 116, 144, 0.7)', // cyan-700
        borderColor: 'rgba(14, 116, 144, 1)',
        borderWidth: 1,
      },
    ],
  };

  const options = {
    indexAxis: 'y',
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        beginAtZero: true,
        max: 100,
        ticks: { display: false },
        grid: { display: false },
        title: { display: true, text: 'Tactical/Personal Focus â†’ Strategic/Portfolio Focus', color: '#475569' },
      },
      y: {
        grid: { display: false },
        ticks: { color: '#475569' },
      },
    },
    plugins: {
      legend: { position: 'bottom', labels: { color: '#475569' } },
      tooltip: {
        callbacks: {
          label: function (context) {
            let label = context.dataset.label || '';
            if (label) { label += ': '; }
            const val = context.raw;
            const category = context.label;
            if (category === 'Risk Profile') label += val > 50 ? 'High Personal Risk' : 'Managed/Diversified';
            if (category === 'Operational Focus') label += val > 50 ? 'Hands-On/Tactical' : 'Oversight/Strategic';
            if (category === 'Capital Source') label += val > 50 ? 'Personal/Creative' : 'Institutional';
            if (category === 'Decision Driver') label += val > 50 ? 'Cash Flow/Survival' : 'Risk-Adjusted Returns';
            return label;
          },
        },
      },
    },
  };

  return (
    <div className="relative h-96 w-full max-w-2xl mx-auto">
      <Bar data={data} options={options} />
    </div>
  );
};

// Component to render the HOA Board Health Assessment Chart.
const HOARiskChart = ({ scores }) => {
    const data = {
        labels: ['Governance', 'Financials', 'Operations', 'Community'],
        datasets: [{
            label: 'Risk Level',
            data: [scores.governance, scores.financials, scores.operations, scores.community],
            backgroundColor: 'rgba(20, 184, 166, 0.2)', // teal-500
            borderColor: 'rgb(13, 148, 136)', // teal-600
            pointBackgroundColor: 'rgb(13, 148, 136)',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: 'rgb(13, 148, 136)',
            borderWidth: 2,
        }],
    };

    const options = {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            r: {
                angleLines: { display: false },
                suggestedMin: 0,
                suggestedMax: 100,
                grid: { color: '#d1fae5' }, // green-100
                pointLabels: {
                    font: { size: 14, weight: 'bold' },
                    color: '#047857' // green-700
                },
                ticks: {
                    display: false,
                    stepSize: 25,
                }
            },
        },
        plugins: {
            legend: { display: false },
            tooltip: {
                callbacks: {
                    label: (context) => `Risk Score: ${context.raw}`
                }
            }
        },
    };

    return (
        <div className="relative h-80 w-full max-w-lg mx-auto">
            <Radar data={data} options={options} />
        </div>
    );
};
// END: Chart Components


// START: Page Components
// The Home Page presents the initial "fork in the road" for user self-selection.
const HomePage = ({ onNavigate }) => (
  <div className="fade-in text-center max-w-3xl mx-auto py-16">
    <h1 className="text-4xl md:text-5xl font-bold text-slate-900 mb-4">The Property Leadership OS</h1>
    <p className="text-lg text-slate-600 mb-8">
      An integrated digital resource for the complex job of property leadership. Select your role to access a tailored experience with tools and insights designed for your unique challenges.
    </p>
    <div className="flex flex-col md:flex-row gap-4 justify-center">
      <Button onClick={() => onNavigate('investor')}>
        I am a Multifamily Investor
      </Button>
      <Button onClick={() => onNavigate('hoa')} variant="secondary">
        I am an HOA Board Member
      </Button>
    </div>
  </div>
);

// The Investor Page, implementing the secondary fork for sub-persona selection.
const InvestorPage = () => {
  const [selectedPersona, setSelectedPersona] = useState(null);

  const personaData = {
    emerging: {
      title: 'For The Emerging Investor',
      toolTitle: 'Essential Tool: First Deal Red Flag Analyzer',
      toolDescription: `This checklist-based wizard helps you combat the "snowball effect" that plagues new investors. Input key details of a potential property (age, construction, deferred maintenance) and the tool generates a "Risk Score" with clear explanations, highlighting hidden costs and operational challenges.`,
      toolBenefit: `This transforms our site from an information provider into your strategic due diligence partner, helping you avoid a disastrous first deal.`
    },
    institutional: {
      title: 'For The Institutional Strategist',
      toolTitle: 'Essential Tool: Value-Add ROI Modeler',
      toolDescription: `A sophisticated tool for portfolio managers to model the financial impact of renovation scenarios. Input costs for different upgrade packages, projected rent premiums, and market cap rates. The modeler outputs a comprehensive pro forma, projecting the impact on NOI, cash-on-cash return, and total asset value.`,
      toolBenefit: `This provides the quantitative justification required for high-stakes capital allocation decisions.`
    }
  };

  const ToolSection = ({ persona }) => (
    <div className="mt-12 bg-sky-50 p-8 rounded-lg fade-in">
        <h3 className="text-2xl font-bold text-sky-900 mb-4">{personaData[persona].toolTitle}</h3>
        <p className="text-slate-700 mb-4">{personaData[persona].toolDescription}</p>
        <p className="font-semibold text-sky-800">{personaData[persona].toolBenefit}</p>
    </div>
  );

  return (
    <div className="fade-in max-w-7xl mx-auto py-12">
      <div className="text-center mb-12">
        <h2 className="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Multifamily Investor Central</h2>
        <p className="text-lg text-slate-600 max-w-3xl mx-auto">
          This is your hub as a Business Optimizer. Whether you're buying your first duplex or managing a nationwide portfolio, this space provides the strategic insights and tools you need to maximize ROI and asset value. First, identify your current focus.
        </p>
      </div>

      <div className="grid md:grid-cols-2 gap-8 items-start mb-12">
        <Card 
            className={`hover:border-sky-500 hover:scale-105 border-2 ${selectedPersona === 'emerging' ? 'border-sky-500 scale-105' : 'border-transparent'}`}
            onClick={() => setSelectedPersona('emerging')}
        >
          <h3 className="text-2xl font-bold text-sky-800 mb-3">The Emerging Investor</h3>
          <p className="text-slate-600 mb-4">For the hands-on operator managing a job, focused on tactical execution and avoiding catastrophic mistakes on the path to financial freedom.</p>
        </Card>
        <Card
            className={`hover:border-sky-500 hover:scale-105 border-2 ${selectedPersona === 'institutional' ? 'border-sky-500 scale-105' : 'border-transparent'}`}
            onClick={() => setSelectedPersona('institutional')}
        >
          <h3 className="text-2xl font-bold text-sky-800 mb-3">The Institutional Strategist</h3>
          <p className="text-slate-600 mb-4">For the portfolio manager managing capital, focused on macro strategy, risk-adjusted returns, and operational scale.</p>
        </Card>
      </div>

      {selectedPersona && <ToolSection persona={selectedPersona} />}

      <Card className="mt-12">
        <h3 className="text-xl font-bold text-center text-slate-800 mb-4">Investor Persona Comparison: Key Distinctions</h3>
        <p className="text-center text-slate-600 text-sm mb-4 max-w-3xl mx-auto">
          While both are investors, their focus and information needs differ dramatically. This chart highlights where their priorities lie, illustrating why a one-size-fits-all approach fails.
        </p>
        <InvestorComparisonChart />
      </Card>
    </div>
  );
};

// The HOA Page, featuring the interactive Board Health Assessment tool.
const HOAPage = () => {
    const [answers, setAnswers] = useState({});
    const [showResults, setShowResults] = useState(false);
    const [scores, setScores] = useState({ governance: 0, financials: 0, operations: 0, community: 0 });

    const questions = [
        { id: 'q1', category: 'governance', text: 'Does your board have a D&O insurance policy?' },
        { id: 'q2', category: 'governance', text: 'Are board meeting minutes formally approved and stored in an accessible location?' },
        { id: 'q3', category: 'financials', text: 'Do you have a professional reserve study that is less than 3 years old?' },
        { id: 'q4', category: 'financials', text: 'Does your annual budget have a line item for funding the reserve account?' },
        { id: 'q5', category: 'operations', text: 'Do you have a written, consistent policy for handling rule violations?' },
        { id: 'q6', category: 'operations', text: 'Do you use a standardized process for vetting and hiring contractors?' },
        { id: 'q7', category: 'community', text: 'Does the board communicate with homeowners through regular newsletters or updates?' },
        { id: 'q8', category: 'community', text: 'Do you have a formal process for handling homeowner complaints?' },
    ];
    
    const handleAnswerChange = (qid, value) => {
        setAnswers(prev => ({ ...prev, [qid]: value }));
    };

    const calculateResults = () => {
        const categoryPoints = { governance: { total: 0, count: 0 }, financials: { total: 0, count: 0 }, operations: { total: 0, count: 0 }, community: { total: 0, count: 0 }};
        questions.forEach(q => {
            const answer = answers[q.id];
            if(answer !== undefined) {
                categoryPoints[q.category].total += answer ? 0 : 1; // 0 for Yes (low risk), 1 for No (high risk)
                categoryPoints[q.category].count++;
            }
        });
        
        const newScores = {};
        for(const category in categoryPoints){
            const { total, count } = categoryPoints[category];
            newScores[category] = count > 0 ? (total / count) * 100 : 0;
        }

        setScores(newScores);
        setShowResults(true);
    };

    const getRiskLevel = (score) => {
        if (score > 66) return { level: 'High Risk', color: 'text-red-600', advice: 'Immediate attention needed.' };
        if (score > 33) return { level: 'Moderate Risk', color: 'text-yellow-600', advice: 'Area for improvement.' };
        return { level: 'Low Risk', color: 'text-green-600', advice: 'Good practices in place.' };
    }

    return (
        <div className="fade-in max-w-7xl mx-auto py-12">
            <div className="text-center mb-12">
                <h2 className="text-3xl md:text-4xl font-bold text-slate-900 mb-2">HOA Board HQ</h2>
                <p className="text-lg text-slate-600 max-w-3xl mx-auto">This is your Board Member Survival Kit. As an "Accidental Executive," you face unique pressures. This resource provides practical, step-by-step guidance to help you navigate your role with confidence and mitigate risk.</p>
            </div>

            <Card>
                <h3 className="text-2xl font-bold text-teal-800 mb-4">HOA Board Health & Risk Assessment</h3>
                <p className="text-slate-600 mb-6">Answer these questions about your board's operations to get a confidential risk profile and a prioritized action plan to protect your community.</p>

                <div className="space-y-6">
                    {questions.map((q, index) => (
                        <div key={q.id} className="p-4 bg-teal-50 rounded-lg">
                            <p className="font-semibold text-slate-800 mb-2">{index + 1}. {q.text}</p>
                            <div className="flex gap-4">
                                <label className="flex items-center gap-2">
                                    <input type="radio" name={q.id} onChange={() => handleAnswerChange(q.id, true)} className="form-radio text-teal-600"/> Yes
                                </label>
                                <label className="flex items-center gap-2">
                                    <input type="radio" name={q.id} onChange={() => handleAnswerChange(q.id, false)} className="form-radio text-teal-600"/> No
                                </label>
                            </div>
                        </div>
                    ))}
                </div>
                <div className="text-center mt-8">
                    <Button onClick={calculateResults} variant="secondary">
                        {showResults ? 'Recalculate My Risk Profile' : 'Get My Risk Profile'}
                    </Button>
                </div>
            </Card>

            {showResults && (
                <Card className="mt-12 fade-in">
                    <h3 className="text-2xl font-bold text-teal-800 mb-6 text-center">Your Board's Risk Profile</h3>
                     <div className="grid md:grid-cols-2 gap-8 items-center">
                        <div>
                           <HOARiskChart scores={scores} />
                        </div>
                        <div className="space-y-4">
                           {Object.entries(scores).map(([category, score]) => {
                               const { level, color, advice } = getRiskLevel(score);
                               return (
                                   <div key={category} className="p-3 bg-gray-50 rounded-lg">
                                       <p className="capitalize font-bold text-slate-700">{category}</p>
                                       <p className={`font-bold ${color}`}>{level}</p>
                                       <p className="text-sm text-slate-500">{advice}</p>
                                   </div>
                               )
                           })}
                        </div>
                     </div>
                </Card>
            )}
        </div>
    );
};

// A placeholder page for the Shared Capital Asset Management Center.
const AssetCenterPage = () => (
    <div className="fade-in text-center max-w-3xl mx-auto py-16">
        <h2 className="text-3xl md:text-4xl font-bold text-slate-900 mb-4">Capital Asset Management Center</h2>
        <p className="text-lg text-slate-600">
            This shared hub will provide strategic analysis on major capital components (siding, windows, etc.) through the lens of both investors and HOAs. Content will include lifecycle cost analysis, ROI assessments for value-add projects, and guides to funding replacements from reserves.
        </p>
        <p className="mt-4 font-semibold text-slate-500">(Content for this section is planned for Phase 2 of development.)</p>
    </div>
);
// END: Page Components


// START: Main App Structure
// This is the main component that renders the entire application.
// It manages the current page state and handles navigation.
export default function App() {
  const [currentPage, setCurrentPage] = useState('home');

  const onNavigate = (page) => {
    setCurrentPage(page);
    window.scrollTo(0, 0);
  };

  const renderPage = () => {
    switch (currentPage) {
      case 'investor':
        return <InvestorPage />;
      case 'hoa':
        return <HOAPage />;
      case 'assets':
        return <AssetCenterPage />;
      case 'home':
      default:
        return <HomePage onNavigate={onNavigate} />;
    }
  };

  return (
    <div className="bg-stone-100 min-h-screen font-sans text-slate-800">
      <header className="bg-white shadow-sm sticky top-0 z-10">
        <nav className="container mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-center h-16">
            <div className="flex-shrink-0">
              <a onClick={() => onNavigate('home')} className="cursor-pointer text-xl font-bold text-slate-800">
                Property Leadership <span className="text-sky-700">OS</span>
              </a>
            </div>
            <div className="hidden md:block">
              <div className="ml-10 flex items-baseline space-x-4">
                <a onClick={() => onNavigate('home')} className={`px-3 py-2 rounded-md text-sm font-medium transition-colors ${currentPage === 'home' ? 'text-sky-700' : 'text-slate-500 hover:text-slate-900'}`}>Home</a>
                <a onClick={() => onNavigate('investor')} className={`px-3 py-2 rounded-md text-sm font-medium transition-colors ${currentPage === 'investor' ? 'text-sky-700' : 'text-slate-500 hover:text-slate-900'}`}>Investor Central</a>
                <a onClick={() => onNavigate('hoa')} className={`px-3 py-2 rounded-md text-sm font-medium transition-colors ${currentPage === 'hoa' ? 'text-teal-700' : 'text-slate-500 hover:text-slate-900'}`}>HOA HQ</a>
                <a onClick={() => onNavigate('assets')} className={`px-3 py-2 rounded-md text-sm font-medium transition-colors ${currentPage === 'assets' ? 'text-slate-900' : 'text-slate-500 hover:text-slate-900'}`}>Asset Center</a>
              </div>
            </div>
          </div>
        </nav>
      </header>
      
      <main className="container mx-auto px-4 sm:px-6 lg:px-8">
        {renderPage()}
      </main>

      <footer className="bg-white mt-16 border-t border-stone-200">
        <div className="container mx-auto py-8 px-4 sm:px-6 lg:px-8 text-center text-slate-500">
          <p>&copy; {new Date().getFullYear()} Property Leadership OS. All rights reserved.</p>
          <p className="text-sm mt-2">A conceptual application based on strategic audience analysis.</p>
        </div>
      </footer>
    </div>
  );
}
// END: Main App Structure
